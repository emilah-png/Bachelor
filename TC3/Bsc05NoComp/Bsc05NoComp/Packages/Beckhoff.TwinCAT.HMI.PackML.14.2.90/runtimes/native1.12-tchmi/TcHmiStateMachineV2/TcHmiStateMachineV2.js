"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiPackML){class TcHmiStateMachineV2 extends TcHmi.Controls.System.TcHmiControl{static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiPackML"+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__pointerMoveHandlerCanvas=this.__onMousemoveCanvas()}__pointerMoveHandlerCanvas;__elementTemplateRoot;__canvasBasis;__canvasStates;__contextBasis;__contextStates;__stateCurrent;__commandSymbol;__commandSymbolDestroyWatch;__commandValue;__unitModeCurrent;__ratioCanvas=860/380;__blinkInterval=0;__blinkState=!1;__stateToHover=TcHmiStateMachineV2.State.Undefined;__canvasEventTargets=[];__selectableStates=[];__eventDestroyerFunctions=[];__stateInformation=new Map([[TcHmiStateMachineV2.State.Clearing,{xStart:this.__getRatioX(370),yStart:this.__getRatioY(300),name:"Clearing",color:"white",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Stopped,{xStart:this.__getRatioX(50),yStart:this.__getRatioY(300),name:"Stopped",color:"#c0c0c5",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Starting,{xStart:this.__getRatioX(220),yStart:this.__getRatioY(120),name:"Starting",color:"white",highlightColor:"#6fd50d",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Idle,{xStart:this.__getRatioX(50),yStart:this.__getRatioY(120),name:"Idle",color:"#c0c0c5",highlightColor:"#6fd50d",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Suspended,{xStart:this.__getRatioX(370),yStart:this.__getRatioY(200),name:"Suspended",color:"#c0c0c5",highlightColor:"#e7e702",unitModes:[TcHmiStateMachineV2.UnitMode.Production]}],[TcHmiStateMachineV2.State.Execute,{xStart:this.__getRatioX(370),yStart:this.__getRatioY(120),name:"Execute",color:"#c0c0c5",highlightColor:"#6fd50d",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Stopping,{xStart:this.__getRatioX(220),yStart:this.__getRatioY(300),name:"Stopping",color:"white",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Aborting,{xStart:this.__getRatioX(690),yStart:this.__getRatioY(300),name:"Aborting",color:"white",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Aborted,{xStart:this.__getRatioX(520),yStart:this.__getRatioY(300),name:"Aborted",color:"#c0c0c5",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Holding,{xStart:this.__getRatioX(520),yStart:this.__getRatioY(40),name:"Holding",color:"white",highlightColor:"#4793da",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance]}],[TcHmiStateMachineV2.State.Held,{xStart:this.__getRatioX(370),yStart:this.__getRatioY(40),name:"Held",color:"#c0c0c5",highlightColor:"#4793da",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance]}],[TcHmiStateMachineV2.State.Unholding,{xStart:this.__getRatioX(220),yStart:this.__getRatioY(40),name:"Unholding",color:"white",highlightColor:"#6fd50d",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance]}],[TcHmiStateMachineV2.State.Suspending,{xStart:this.__getRatioX(520),yStart:this.__getRatioY(200),name:"Suspending",color:"white",highlightColor:"#e7e702",unitModes:[TcHmiStateMachineV2.UnitMode.Production]}],[TcHmiStateMachineV2.State.Unsuspending,{xStart:this.__getRatioX(220),yStart:this.__getRatioY(200),name:"Unsuspending",color:"white",highlightColor:"#00a440",unitModes:[TcHmiStateMachineV2.UnitMode.Production]}],[TcHmiStateMachineV2.State.Resetting,{xStart:this.__getRatioX(50),yStart:this.__getRatioY(200),name:"Resetting",color:"white",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production,TcHmiStateMachineV2.UnitMode.Maintenance,TcHmiStateMachineV2.UnitMode.Manual]}],[TcHmiStateMachineV2.State.Completing,{xStart:this.__getRatioX(520),yStart:this.__getRatioY(120),name:"Completing",color:"white",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production]}],[TcHmiStateMachineV2.State.Complete,{xStart:this.__getRatioX(690),yStart:this.__getRatioY(120),name:"Complete",color:"#c0c0c5",highlightColor:"#E30613",unitModes:[TcHmiStateMachineV2.UnitMode.Production]}]]);__canvasResources={stateTextcolor:"black",stateTextcolorHovered:"black",stateColorHovered:"#ededed",stateBorderColor:"black",transitionColor:"black",transitionTextColor:"black",borderColor:"rgba(0,0,0,0)",baseColor:"#f5f6f7",innerBaseColor:"#ededed"};__stateRadius=10;__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiPackML_TcHmiStateMachineV2-Template")[0],this.__canvasBasis=this.__elementTemplateRoot.getElementsByClassName("Canvas_StateMachine")[0],this.__canvasStates=this.__elementTemplateRoot.getElementsByClassName("Canvas_nextPlane")[0],!this.__elementTemplateRoot||!this.__canvasBasis||!this.__canvasStates)throw new Error("Invalid Template.html");let contextBasis=this.__canvasBasis.getContext("2d");if(!contextBasis)throw new Error("Failed to initialize canvas.");this.__contextBasis=contextBasis;let contextStates=this.__canvasStates.getContext("2d");if(!contextStates)throw new Error("Failed to initialize canvas.");this.__contextStates=contextStates,super.__previnit()}__init(){this.__canvasBasis.addEventListener("mousemove",this.__pointerMoveHandlerCanvas),this.__canvasBasis.addEventListener("click",this.__click),super.__init()}__attach(){super.__attach(),this.__updateThemeColors(),this.__eventDestroyerFunctions.push(TcHmi.EventProvider.register(this.__id+".onResized",this.__onResized)),this.__eventDestroyerFunctions.push(TcHmi.EventProvider.register("onThemeDataChanged",this.__updateThemeColors)),this.__commandSymbol&&!this.__commandSymbolDestroyWatch&&(this.__commandSymbolDestroyWatch=this.__commandSymbol.watch(this.__onCommandSymbolWatch)),this.__onResized()}__detach(){super.__detach(),this.__blinkInterval&&(clearInterval(this.__blinkInterval),this.__blinkInterval=0);for(let e of this.__eventDestroyerFunctions)e();this.__eventDestroyerFunctions=[],this.__commandSymbolDestroyWatch?.(),this.__commandSymbolDestroyWatch=null}destroy(){this.__keepAlive||(this.__canvasBasis.removeEventListener("mousemove",this.__pointerMoveHandlerCanvas),this.__canvasBasis.removeEventListener("click",this.__click),this.__commandSymbolDestroyWatch?.(),this.__commandSymbolDestroyWatch=null,this.__commandSymbol?.destroy(),this.__commandSymbol=void 0,super.destroy())}__click=event=>{if(!TcHmi.Access.checkAccess(this,"AllowStateChange"))return;const canvasPosition=this.__canvasBasis.getBoundingClientRect(),relMousePosition_x=event.pageX-canvasPosition.left,relMousePosition_y=event.pageY-canvasPosition.top;for(const eventTarget of this.__canvasEventTargets)relMousePosition_x>=eventTarget.pos.start.x&&relMousePosition_x<=eventTarget.pos.end.x&&relMousePosition_y>=eventTarget.pos.start.y&&relMousePosition_y<=eventTarget.pos.end.y&&this.__selectableStates.includes(eventTarget.state)&&eventTarget.primaryFn()};__onMousemoveCanvas(){return event=>{if(!TcHmi.Access.checkAccess(this,"AllowStateChange"))return;const canvasPosition=this.__canvasBasis.getBoundingClientRect(),relMousePosition_x=event.pageX-canvasPosition.left,relMousePosition_y=event.pageY-canvasPosition.top;let newStateToHover=TcHmiStateMachineV2.State.Undefined;for(const eventTarget of this.__canvasEventTargets)relMousePosition_x>=eventTarget.pos.start.x&&relMousePosition_x<=eventTarget.pos.end.x&&relMousePosition_y>=eventTarget.pos.start.y&&relMousePosition_y<=eventTarget.pos.end.y&&this.__selectableStates.includes(eventTarget.state)&&(newStateToHover=eventTarget.state);newStateToHover!==this.__stateToHover&&(this.__stateToHover=newStateToHover,this.__updateStateRepresentations())}}__onResized=()=>{const scaleX=this.__elementTemplateRoot.offsetWidth/this.__ratioCanvas,scaledHeight=Math.round(Math.min(scaleX,this.__elementTemplateRoot.offsetHeight)),scaledWidth=Math.round(scaledHeight*this.__ratioCanvas);this.__canvasBasis.style.width=scaledWidth+"px",this.__canvasBasis.style.height=scaledHeight+"px",this.__canvasStates.style.width=this.__canvasBasis.style.width,this.__canvasStates.style.height=this.__canvasBasis.style.height;const deviceRatio=window.devicePixelRatio;this.__canvasBasis.width=Math.floor(scaledWidth*deviceRatio),this.__canvasBasis.height=Math.floor(scaledHeight*deviceRatio),this.__contextBasis.scale(deviceRatio,deviceRatio),this.__canvasStates.width=Math.floor(scaledWidth*deviceRatio),this.__canvasStates.height=Math.floor(scaledHeight*deviceRatio),this.__contextStates.scale(deviceRatio,deviceRatio),this.__centerCanvas(this.__canvasBasis),this.__centerCanvas(this.__canvasStates),this.__drawBasis(),this.__updateStateRepresentations()};__updateThemeColors=()=>{for(let stateInfo of this.__stateInformation.values()){let color=TcHmi.Theme.Resources.get(this,"states/"+stateInfo.name+"/color").value;TcHmi.isSolidColor(color)?stateInfo.color=color.color:TcHmi.Log.warn(`No themed value for states/${stateInfo.name}/color`);let highlightColor=TcHmi.Theme.Resources.get(this,"states/"+stateInfo.name+"/highlightColor").value;TcHmi.isSolidColor(highlightColor)?stateInfo.highlightColor=highlightColor.color:TcHmi.Log.warn(`No themed value for states/${stateInfo.name}/highlightColor`)}let keys=Object.keys(this.__canvasResources);for(let key of keys){let color=TcHmi.Theme.Resources.get(this,key).value;TcHmi.isSolidColor(color)?this.__canvasResources[key]=color.color:TcHmi.Log.warn(`No themed value for ${key}`)}this.__drawBasis(),this.__updateStateRepresentations()};__processAccessConfig(){super.__processAccessConfig(),this.__element[0].classList.toggle("forbid-state-change",!TcHmi.Access.checkAccess(this,"AllowStateChange")),this.__updateStateRepresentations()}__getRatioX(pos){return pos/860}__getPositionX(pos){return Math.floor(this.__getRatioX(pos)*this.__canvasBasis.clientWidth)}__getRatioY(pos){return pos/380}__getPositionY(pos){return Math.floor(this.__getRatioY(pos)*this.__canvasBasis.clientHeight)}__drawBasis(){let canvasWidth=this.__canvasBasis.width/window.devicePixelRatio,canvasHeight=this.__canvasBasis.height/window.devicePixelRatio;this.__contextBasis.clearRect(0,0,canvasWidth,canvasHeight),this.__canvasEventTargets=[],this.__contextBasis.beginPath(),this.__contextBasis.strokeStyle=this.__canvasResources.borderColor,this.__contextBasis.shadowBlur=2,this.__contextBasis.moveTo(this.__getPositionX(10),this.__getPositionY(10)),this.__contextBasis.lineTo(this.__getPositionX(845),this.__getPositionY(10)),this.__contextBasis.lineTo(this.__getPositionX(845),this.__getPositionY(280)),this.__contextBasis.lineTo(this.__getPositionX(505),this.__getPositionY(280)),this.__contextBasis.lineTo(this.__getPositionX(505),this.__getPositionY(370)),this.__contextBasis.lineTo(this.__getPositionX(10),this.__getPositionY(370)),this.__contextBasis.lineTo(this.__getPositionX(10),this.__getPositionY(10)),this.__contextBasis.stroke(),this.__contextBasis.closePath(),this.__contextBasis.fillStyle=this.__canvasResources.baseColor,this.__contextBasis.fill(),this.__contextBasis.beginPath(),this.__contextBasis.strokeStyle=this.__canvasResources.borderColor,this.__contextBasis.fillStyle=this.__canvasResources.innerBaseColor,this.__contextBasis.lineWidth=1,this.__contextBasis.fillRect(this.__getPositionX(20),this.__getPositionX(20),this.__getPositionX(815),this.__getPositionY(250)),this.__contextBasis.strokeRect(this.__getPositionX(20),this.__getPositionX(20),this.__getPositionX(815),this.__getPositionY(250)),this.__contextBasis.closePath(),this.__contextBasis&&(this.__contextBasis.beginPath(),this.__contextBasis.fillStyle=this.__canvasResources.baseColor,this.__contextBasis.fillRect(this.__getPositionX(501),this.__getPositionY(306),this.__getPositionX(5),this.__getPositionY(9)),this.__contextBasis.closePath()),this.__contextBasis.fillStyle=this.__canvasResources.transitionTextColor,this.__contextBasis.textAlign="left",this.__contextBasis.font=this.__getPositionX(10)+"px RobotoCondensed",this.__contextBasis.fillText("Unit Mode: "+TcHmiStateMachineV2.UnitMode[this.__unitModeCurrent??0],this.__getPositionX(30),this.__getPositionY(40)),(this.__unitModeCurrent||TCHMI_DESIGNER)&&(this.__drawArrow(this.__contextBasis,this.__getPositionX(750),this.__getPositionY(280),this.__getPositionX(750),this.__getPositionY(300),"Down"),this.__drawArrow(this.__contextBasis,this.__getPositionX(690),this.__getPositionY(320),this.__getPositionX(640),this.__getPositionY(320),"Left"),this.__drawArrow(this.__contextBasis,this.__getPositionX(520),this.__getPositionY(320),this.__getPositionX(490),this.__getPositionY(320),"Left"),this.__drawArrow(this.__contextBasis,this.__getPositionX(280),this.__getPositionY(270),this.__getPositionX(280),this.__getPositionY(300),"Down"),this.__drawArrow(this.__contextBasis,this.__getPositionX(220),this.__getPositionY(320),this.__getPositionX(170),this.__getPositionY(320),"Left"),this.__drawArrow(this.__contextBasis,this.__getPositionX(110),this.__getPositionY(300),this.__getPositionX(110),this.__getPositionY(240),"Up"),this.__drawArrow(this.__contextBasis,this.__getPositionX(110),this.__getPositionY(200),this.__getPositionX(110),this.__getPositionY(160),"Up"),this.__drawArrow(this.__contextBasis,this.__getPositionX(170),this.__getPositionY(140),this.__getPositionX(220),this.__getPositionY(140),"Right"),this.__drawArrow(this.__contextBasis,this.__getPositionX(340),this.__getPositionY(140),this.__getPositionX(370),this.__getPositionY(140),"Right"),this.__drawLine(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(350),this.__getPositionX(355),this.__getPositionY(320)),this.__drawLine(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(320),this.__getPositionX(370),this.__getPositionY(320)),this.__drawLine(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(350),this.__getPositionX(195),this.__getPositionY(350)),this.__drawLine(this.__contextBasis,this.__getPositionX(195),this.__getPositionY(350),this.__getPositionX(195),this.__getPositionY(320)),this.__drawArrow(this.__contextBasis,this.__getPositionX(195),this.__getPositionY(320),this.__getPositionX(170),this.__getPositionY(320),"Left"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(770),this.__getPositionY(292),"Abort"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(670),this.__getPositionY(315),"SC"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(505),this.__getPositionY(312),"Clear"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(297),this.__getPositionY(292),"Stop"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(195),this.__getPositionY(315),"SC"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(125),this.__getPositionY(292),"Reset"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(125),this.__getPositionY(187),"SC"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(195),this.__getPositionY(135),"Start"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(135),"SC")),(this.__unitModeCurrent===TcHmiStateMachineV2.UnitMode.Production||this.__unitModeCurrent===TcHmiStateMachineV2.UnitMode.Maintenance||TCHMI_DESIGNER)&&(this.__drawArrow(this.__contextBasis,this.__getPositionX(520),this.__getPositionY(60),this.__getPositionX(490),this.__getPositionY(60),"Left"),this.__drawArrow(this.__contextBasis,this.__getPositionX(370),this.__getPositionY(60),this.__getPositionX(340),this.__getPositionY(60),"Left"),this.__drawLine(this.__contextBasis,this.__getPositionX(440),this.__getPositionY(120),this.__getPositionX(440),this.__getPositionY(105)),this.__drawLine(this.__contextBasis,this.__getPositionX(440),this.__getPositionY(105),this.__getPositionX(580),this.__getPositionY(105)),this.__drawArrow(this.__contextBasis,this.__getPositionX(580),this.__getPositionY(105),this.__getPositionX(580),this.__getPositionY(80),"Up"),this.__drawLine(this.__contextBasis,this.__getPositionX(280),this.__getPositionY(80),this.__getPositionX(280),this.__getPositionY(105)),this.__drawLine(this.__contextBasis,this.__getPositionX(280),this.__getPositionY(105),this.__getPositionX(420),this.__getPositionY(105)),this.__drawArrow(this.__contextBasis,this.__getPositionX(420),this.__getPositionY(105),this.__getPositionX(420),this.__getPositionY(120),"Down"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(505),this.__getPositionY(100),"Hold"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(505),this.__getPositionY(50),"SC"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(40),"Un-"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(52),"Hold"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(100),"SC")),(this.__unitModeCurrent===TcHmiStateMachineV2.UnitMode.Production||TCHMI_DESIGNER)&&(this.__drawArrow(this.__contextBasis,this.__getPositionX(490),this.__getPositionY(140),this.__getPositionX(520),this.__getPositionY(140),"Right"),this.__drawArrow(this.__contextBasis,this.__getPositionX(640),this.__getPositionY(140),this.__getPositionX(690),this.__getPositionY(140),"Right"),this.__drawArrow(this.__contextBasis,this.__getPositionX(520),this.__getPositionY(220),this.__getPositionX(490),this.__getPositionY(220),"Left"),this.__drawArrow(this.__contextBasis,this.__getPositionX(370),this.__getPositionY(220),this.__getPositionX(340),this.__getPositionY(220),"Left"),this.__drawLine(this.__contextBasis,this.__getPositionX(750),this.__getPositionY(160),this.__getPositionX(750),this.__getPositionY(260)),this.__drawLine(this.__contextBasis,this.__getPositionX(750),this.__getPositionY(260),this.__getPositionX(110),this.__getPositionY(260)),this.__drawArrow(this.__contextBasis,this.__getPositionX(110),this.__getPositionY(260),this.__getPositionX(110),this.__getPositionY(240),"Up"),this.__drawLine(this.__contextBasis,this.__getPositionX(440),this.__getPositionY(160),this.__getPositionX(440),this.__getPositionY(175)),this.__drawLine(this.__contextBasis,this.__getPositionX(440),this.__getPositionY(175),this.__getPositionX(580),this.__getPositionY(175)),this.__drawArrow(this.__contextBasis,this.__getPositionX(580),this.__getPositionY(175),this.__getPositionX(580),this.__getPositionY(200),"Down"),this.__drawLine(this.__contextBasis,this.__getPositionX(280),this.__getPositionY(200),this.__getPositionX(280),this.__getPositionY(175)),this.__drawLine(this.__contextBasis,this.__getPositionX(280),this.__getPositionY(175),this.__getPositionX(420),this.__getPositionY(175)),this.__drawArrow(this.__contextBasis,this.__getPositionX(420),this.__getPositionY(175),this.__getPositionX(420),this.__getPositionY(160),"Up"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(505),this.__getPositionY(135),"SC"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(665),this.__getPositionY(135),"SC"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(195),this.__getPositionY(255),"Reset"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(505),this.__getPositionY(187),"Suspend"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(505),this.__getPositionY(238),"SC"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(238),"Un-"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(250),"Suspend"),this.__addTextToTransition(this.__contextBasis,this.__getPositionX(355),this.__getPositionY(187),"SC")),this.__canvasEventTargets=[];for(const[key,stateInfo]of this.__stateInformation){if(!stateInfo.unitModes.includes(this.__unitModeCurrent??0)&&!TCHMI_DESIGNER)continue;this.__drawState(this.__contextBasis,key);const xStart=Math.floor(stateInfo.xStart*this.__canvasStates.clientWidth),yStart=Math.floor(stateInfo.yStart*this.__canvasStates.clientHeight),width=this.__getPositionX(120),height=this.__getPositionY(40);this.__canvasEventTargets.push({pos:{start:{x:xStart,y:yStart},end:{x:xStart+width,y:yStart+height}},primaryFn:()=>{switch(key){case TcHmiStateMachineV2.State.Stopped:this.__stateCurrent===TcHmiStateMachineV2.State.Aborted||this.__stateCurrent===TcHmiStateMachineV2.State.Aborting?this.__writeCommand(TcHmiStateMachineV2.Command.Clear):this.__writeCommand(TcHmiStateMachineV2.Command.Stop);break;case TcHmiStateMachineV2.State.Idle:this.__writeCommand(TcHmiStateMachineV2.Command.Reset);break;case TcHmiStateMachineV2.State.Suspended:this.__writeCommand(TcHmiStateMachineV2.Command.Suspend);break;case TcHmiStateMachineV2.State.Execute:this.__stateCurrent!==TcHmiStateMachineV2.State.Idle&&this.__stateCurrent!==TcHmiStateMachineV2.State.Resetting||this.__writeCommand(TcHmiStateMachineV2.Command.Start),this.__stateCurrent!==TcHmiStateMachineV2.State.Held&&this.__stateCurrent!==TcHmiStateMachineV2.State.Execute&&this.__stateCurrent!==TcHmiStateMachineV2.State.Holding||this.__writeCommand(TcHmiStateMachineV2.Command.UnHold),this.__stateCurrent!==TcHmiStateMachineV2.State.Suspended&&this.__stateCurrent!==TcHmiStateMachineV2.State.Suspending||this.__writeCommand(TcHmiStateMachineV2.Command.Unsuspend);break;case TcHmiStateMachineV2.State.Aborted:this.__writeCommand(TcHmiStateMachineV2.Command.Abort);break;case TcHmiStateMachineV2.State.Held:this.__writeCommand(TcHmiStateMachineV2.Command.Hold)}},state:key})}}__updateStateRepresentations(){let canvasWidth=this.__canvasStates.width/window.devicePixelRatio,canvasHeight=this.__canvasStates.height/window.devicePixelRatio;this.__contextStates.clearRect(0,0,canvasWidth,canvasHeight),this.__drawHoveredState(this.__contextStates,this.__stateToHover),this.__highlightStateCurrent(this.__contextStates),this.__drawSelectableStates(this.__contextStates)}__drawLine(context,xStart,yStart,xEnd,yEnd){context.beginPath(),context.fillStyle=this.__canvasResources.transitionColor,context.strokeStyle=this.__canvasResources.transitionColor,context.lineWidth=1,context.moveTo(xStart,yStart),context.lineTo(xEnd,yEnd),context.stroke(),context.closePath()}__drawState(context,state,active=!1){const stateInformation=this.__stateInformation.get(state);if(!stateInformation)return;const xStart=Math.floor(stateInformation.xStart*this.__canvasStates.clientWidth),yStart=Math.floor(stateInformation.yStart*this.__canvasStates.clientHeight),width=this.__getPositionX(120),height=this.__getPositionY(40);context.beginPath(),context.strokeStyle=this.__canvasResources.stateBorderColor,context.fillStyle=active?stateInformation.highlightColor:stateInformation.color,context.lineWidth=1,context.roundRect(xStart,yStart,width,height,this.__stateRadius),context.fill(),context.stroke(),context.closePath(),this.__addTextToState(context,xStart+this.__getPositionX(10),yStart+this.__getPositionY(20),stateInformation.name,this.__getPositionY(50),this.__canvasResources.stateTextcolor)}__drawHoveredState(context,state){if(!state)return;const stateInformation=this.__stateInformation.get(state);if(!stateInformation)return;const xStart=Math.floor(stateInformation.xStart*this.__canvasStates.clientWidth),yStart=Math.floor(stateInformation.yStart*this.__canvasStates.clientHeight),width=this.__getPositionX(120),height=this.__getPositionY(40);context.beginPath(),context.strokeStyle=this.__canvasResources.stateBorderColor,context.fillStyle=this.__canvasResources.stateColorHovered,context.lineWidth=2,context.roundRect(xStart,yStart,width,height,this.__stateRadius),context.fill(),context.stroke(),context.closePath(),this.__addTextToState(context,xStart+this.__getPositionX(10),yStart+this.__getPositionY(20),stateInformation.name,this.__getPositionY(50),this.__canvasResources.stateTextcolorHovered)}__drawSelectableState(context,state){if(!state)return;const stateInformation=this.__stateInformation.get(state);if(!stateInformation)return;const xStart=Math.floor(stateInformation.xStart*this.__canvasStates.clientWidth),yStart=Math.floor(stateInformation.yStart*this.__canvasStates.clientHeight),width=this.__getPositionX(120),height=this.__getPositionY(40);context.beginPath(),context.strokeStyle=this.__canvasResources.stateBorderColor,context.lineWidth=2,context.roundRect(xStart,yStart,width,height,this.__stateRadius),context.stroke(),context.closePath()}__highlightStateCurrent(context){if(!this.__stateCurrent)return;let stateInfo=this.__stateInformation.get(this.__stateCurrent);if(stateInfo?.unitModes.includes(this.__unitModeCurrent??0))switch(this.__stateCurrent){case TcHmiStateMachineV2.State.Clearing:case TcHmiStateMachineV2.State.Idle:case TcHmiStateMachineV2.State.Aborting:case TcHmiStateMachineV2.State.Aborted:if(this.__drawState(context,this.__stateCurrent,this.__blinkState),this.__blinkInterval)break;this.__blinkInterval=setInterval((()=>{if(!this.__stateCurrent)return clearInterval(this.__blinkInterval),void(this.__blinkInterval=0);this.__blinkState=!this.__blinkState,this.__drawState(context,this.__stateCurrent,this.__blinkState)}),500);break;default:clearInterval(this.__blinkInterval),this.__blinkInterval=0,this.__drawState(context,this.__stateCurrent,!0)}}__drawSelectableStates(context){if(TcHmi.Access.checkAccess(this,"AllowStateChange")&&this.__commandSymbol){switch(this.__selectableStates=[],this.__stateCurrent){case TcHmiStateMachineV2.State.Held:case TcHmiStateMachineV2.State.Idle:this.__selectableStates=[TcHmiStateMachineV2.State.Execute,TcHmiStateMachineV2.State.Aborted,TcHmiStateMachineV2.State.Stopped];break;case TcHmiStateMachineV2.State.Execute:this.__selectableStates=[TcHmiStateMachineV2.State.Held,TcHmiStateMachineV2.State.Suspended,TcHmiStateMachineV2.State.Aborted,TcHmiStateMachineV2.State.Stopped];break;case TcHmiStateMachineV2.State.Complete:this.__selectableStates=[TcHmiStateMachineV2.State.Resetting,TcHmiStateMachineV2.State.Aborted,TcHmiStateMachineV2.State.Stopped];break;case TcHmiStateMachineV2.State.Suspended:this.__selectableStates=[TcHmiStateMachineV2.State.Execute,TcHmiStateMachineV2.State.Aborted,TcHmiStateMachineV2.State.Stopped];break;case TcHmiStateMachineV2.State.Stopped:this.__selectableStates=[TcHmiStateMachineV2.State.Idle,TcHmiStateMachineV2.State.Aborted];break;case TcHmiStateMachineV2.State.Aborted:this.__selectableStates=[TcHmiStateMachineV2.State.Stopped]}for(let state of this.__selectableStates){let stateInformation=this.__stateInformation.get(state);stateInformation?.unitModes.includes(this.__unitModeCurrent??0)&&this.__drawSelectableState(context,state)}}}__drawArrow(context,xStart,yStart,xEnd,yEnd,arrowDirection){switch(this.__drawLine(context,xStart,yStart,xEnd,yEnd),context.beginPath(),context.strokeStyle=this.__canvasResources.transitionColor,context.lineWidth=1,context.moveTo(xEnd,yEnd),arrowDirection){case"Right":context.lineTo(xEnd-this.__getPositionX(10),yEnd-this.__getPositionY(5)),context.lineTo(xEnd-this.__getPositionX(10),yEnd+this.__getPositionY(5));break;case"Left":context.lineTo(xEnd+this.__getPositionX(10),yEnd-this.__getPositionY(5)),context.lineTo(xEnd+this.__getPositionX(10),yEnd+this.__getPositionY(5));break;case"Down":context.lineTo(xEnd+this.__getPositionX(5),yEnd-this.__getPositionY(10)),context.lineTo(xEnd-this.__getPositionX(5),yEnd-this.__getPositionY(10));break;case"Up":context.lineTo(xEnd-this.__getPositionX(5),yEnd+this.__getPositionY(10)),context.lineTo(xEnd+this.__getPositionX(5),yEnd+this.__getPositionY(10))}context.lineTo(xEnd,yEnd),context.fill(),context.closePath()}__addTextToState(context,xStart,yStart,text,offsetX,textColor){context.fillStyle=textColor,context.textAlign="center",context.textBaseline="middle",context.font=this.__getPositionX(15)+"px RobotoCondensed",context.fillText(text,xStart+offsetX,yStart,this.__getPositionX(100))}__addTextToTransition(context,xStart,yStart,text,textAlign="center"){context.fillStyle=this.__canvasResources.transitionTextColor,context.textAlign=textAlign,context.textBaseline="alphabetic",context.font=this.__getPositionX(10)+"px RobotoCondensed",context.fillText(text,xStart,yStart,this.__getPositionX(50))}__centerCanvas(canvas){let left=0,top=0;this.__elementTemplateRoot.clientWidth-1>this.__canvasStates.clientWidth?top=(this.__elementTemplateRoot.clientWidth-this.__canvasStates.clientWidth)/2:this.__elementTemplateRoot.clientHeight-1>this.__canvasStates.clientHeight&&(left=(this.__elementTemplateRoot.clientHeight-this.__canvasStates.clientHeight)/2),canvas.style.left=top+"px",canvas.style.top=left+"px"}__writeCommand(command){this.__commandSymbol?.write(command,(data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiStateMachineV2.#tchmiFQN!==this.__type?", Origin="+TcHmiStateMachineV2.#tchmiFQN:"")}, Id=${this.getId()}, Attribute=Command, Symbol=${this.__commandSymbol?.getExpression().toString()}] `+TcHmi.Log.buildMessage(data.details))}))}setStateCurrent(valueNew){let convertedValue=TcHmi.ValueConverter.toEnum(valueNew,TcHmiStateMachineV2.State)??TcHmi.ValueConverter.toEnum(this.getAttributeDefaultValueInternal("StateCurrent"),TcHmiStateMachineV2.State,TcHmiStateMachineV2.State.Undefined);convertedValue!==this.__stateCurrent&&(this.__stateCurrent=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"StateCurrent"}),this.__processStateCurrent())}getStateCurrent(){if(void 0!==this.__stateCurrent)return null===this.__stateCurrent?null:TcHmiStateMachineV2.State[this.__stateCurrent]}__processStateCurrent(){this.__isAttached&&this.__updateStateRepresentations()}setCommand(valueNew){let newSymbol=valueNew;if(null===newSymbol){let symbolExpression=this.getAttributeDefaultValueInternal("Command");symbolExpression&&(newSymbol=new TcHmi.Symbol(symbolExpression))}newSymbol!==this.__commandSymbol&&(this.__commandSymbolDestroyWatch&&(this.__commandSymbolDestroyWatch(),this.__commandSymbolDestroyWatch=null),this.__commandSymbol&&this.__commandSymbol.destroy(),this.__commandSymbol=newSymbol,newSymbol instanceof TcHmi.Symbol&&this.__isAttached&&(this.__commandSymbolDestroyWatch=this.__commandSymbol.watch(this.__onCommandSymbolWatch)),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Command"}))}__onCommandSymbolWatch=data=>{data.error===TcHmi.Errors.NONE?this.__commandValue=data.value:TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiStateMachineV2.#tchmiFQN!==this.__type?", Origin="+TcHmiStateMachineV2.#tchmiFQN:"")}, Id=${this.getId()}, Attribute=Command, Symbol=${this.__commandSymbol?.getExpression().toString()}] `+TcHmi.Log.buildMessage(data.details))};getCommand(){return this.__commandSymbol}setUnitModeCurrent(valueNew){let convertedValue=TcHmi.ValueConverter.toEnum(valueNew,TcHmiStateMachineV2.UnitMode)??TcHmi.ValueConverter.toEnum(this.getAttributeDefaultValueInternal("UnitModeCurrent"),TcHmiStateMachineV2.UnitMode,TcHmiStateMachineV2.UnitMode.Invalid);convertedValue!==this.__unitModeCurrent&&(this.__unitModeCurrent=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UnitModeCurrent"}),this.__processUnitModeCurrent())}getUnitModeCurrent(){if(void 0!==this.__unitModeCurrent)return null===this.__unitModeCurrent?null:TcHmiStateMachineV2.UnitMode[this.__unitModeCurrent]}__processUnitModeCurrent(){this.__isAttached&&(this.__drawBasis(),this.__updateStateRepresentations())}}TcHmiPackML.TcHmiStateMachineV2=TcHmiStateMachineV2,function(TcHmiStateMachineV2){let State,Command,UnitMode;!function(State){State[State.Undefined=0]="Undefined",State[State.Clearing=1]="Clearing",State[State.Stopped=2]="Stopped",State[State.Starting=3]="Starting",State[State.Idle=4]="Idle",State[State.Suspended=5]="Suspended",State[State.Execute=6]="Execute",State[State.Stopping=7]="Stopping",State[State.Aborting=8]="Aborting",State[State.Aborted=9]="Aborted",State[State.Holding=10]="Holding",State[State.Held=11]="Held",State[State.Unholding=12]="Unholding",State[State.Suspending=13]="Suspending",State[State.Unsuspending=14]="Unsuspending",State[State.Resetting=15]="Resetting",State[State.Completing=16]="Completing",State[State.Complete=17]="Complete"}(State=TcHmiStateMachineV2.State||(TcHmiStateMachineV2.State={})),function(Command){Command[Command.Undefined=0]="Undefined",Command[Command.Reset=1]="Reset",Command[Command.Start=2]="Start",Command[Command.Stop=3]="Stop",Command[Command.Hold=4]="Hold",Command[Command.UnHold=5]="UnHold",Command[Command.Suspend=6]="Suspend",Command[Command.Unsuspend=7]="Unsuspend",Command[Command.Abort=8]="Abort",Command[Command.Clear=9]="Clear"}(Command=TcHmiStateMachineV2.Command||(TcHmiStateMachineV2.Command={})),function(UnitMode){UnitMode[UnitMode.Invalid=0]="Invalid",UnitMode[UnitMode.Production=1]="Production",UnitMode[UnitMode.Maintenance=2]="Maintenance",UnitMode[UnitMode.Manual=3]="Manual"}(UnitMode=TcHmiStateMachineV2.UnitMode||(TcHmiStateMachineV2.UnitMode={}))}(TcHmiStateMachineV2=TcHmiPackML.TcHmiStateMachineV2||(TcHmiPackML.TcHmiStateMachineV2={}))}(Beckhoff.TcHmiPackML||(Beckhoff.TcHmiPackML={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiStateMachineV2","TcHmi.Controls.Beckhoff.TcHmiPackML",TcHmi.Controls.Beckhoff.TcHmiPackML.TcHmiStateMachineV2);