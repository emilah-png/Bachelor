"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(Beckhoff){class TcHmiPdfViewer extends TcHmi.Controls.System.TcHmiControl{static#tchmiFQN="TcHmi.Controls.Beckhoff."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__viewerPath=tchmi_path(TcHmi.Environment.getControlBasePathEx(this)+"/../Lib/pdfjs/web/viewer.html")}__viewerPath;__elementTemplateRoot;__elementIFrame;__file;__page;__namedDestination;__zoom;__pageMode;__allowFullscreen;__disallowFileOperations;__cursorTool;__destroyersToCallOnDestroy=[];__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiPdfViewer-template"),this.__elementIFrame=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiPdfViewer-template-iframe"),0===this.__elementTemplateRoot.length||0===this.__elementIFrame.length)throw new Error("Invalid Template.html");super.__previnit()}__init(){super.__init(),document.addEventListener("webviewerloaded",this.__onWebviewerloaded),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register("onLocaleChanged",this.__updatePdfLocale),TcHmi.EventProvider.register("onThemeDataChanged",this.__updatePdfTheme)),this.__elementIFrame[0].addEventListener("load",this.__onIFrameLoaded),this.__processViewerUpdate()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){if(!this.__keepAlive){document.removeEventListener("webviewerloaded",this.__onWebviewerloaded),this.__elementIFrame[0].removeEventListener("load",this.__onIFrameLoaded);for(const evt of this.__destroyersToCallOnDestroy)evt();this.__destroyersToCallOnDestroy=[],super.destroy()}}__onIFrameLoaded=evt=>{this.__processDisallowFileOperations(),this.__processCursorTool();const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.eventBus.on("pagechanging",(data=>{"number"==typeof data.pageNumber&&this.__page!==data.pageNumber&&(this.__page=data.pageNumber,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Page"}))})),contentWindow?.PDFViewerApplication?.eventBus.on("documentloaded",(data=>{TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PageCount"})}))};__onWebviewerloaded=evt=>{if(!evt.detail)return;const contentWindow=evt.detail.source;this.__allowFullscreen||Object.defineProperty(contentWindow.document,"fullscreenEnabled",{value:!1,writable:!1}),contentWindow.PDFViewerApplicationOptions?.set("disablePreferences",!0),contentWindow.PDFViewerApplicationOptions?.set("locale",TcHmi.Locale.get()??"en");const darkMode=TcHmi.Theme.Resources.get(this,"DarkMode").value;contentWindow.PDFViewerApplicationOptions?.set("viewerCssTheme",darkMode?2:1)};__updatePdfLocale=()=>{const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.initialized&&contentWindow.location.reload()};__updatePdfTheme=()=>{const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.initialized&&contentWindow.location.reload()};getFileAbsolute(){if(TCHMI_DESIGNER)return"";if(!this.__file)return"";if(this.__file.startsWith("/Config/"))return TcHmi.Environment.getHostBaseUri()+this.__file;{let path="";return window.location.pathname&&(path=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))),window.location.protocol+"//"+window.location.host+"/"+tchmi_path(path+"/"+this.__file)}}__processViewerUpdate(){if(!this.__attributesInitialized)return;const fileUrl=this.getFileAbsolute(),hashArray=[];hashArray.push("zoom="+(this.__zoom??"auto")),hashArray.push("pagemode="+(this.__pageMode??"none")),!TCHMI_DESIGNER&&this.__namedDestination&&hashArray.push("nameddest="+this.__namedDestination),!TCHMI_DESIGNER&&this.__page&&hashArray.push("page="+this.__page);this.__elementIFrame[0].src=this.__viewerPath+"?file="+fileUrl+"#"+hashArray.join("&")}setFile(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("File")),convertedValue!==this.__file&&(this.__file=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"File"}),this.__processFile())}getFile(){return this.__file}__processFile(){const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.isInitialViewSet?contentWindow.PDFViewerApplication.open({url:this.getFileAbsolute()}).then((()=>{this.__processPage()})):this.__processViewerUpdate()}setPage(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Page")),convertedValue!==this.__page&&(this.__page=null!==convertedValue?Math.floor(convertedValue):1,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Page"}),this.__processPage())}getPage(){return this.__page}__processPage(){const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.isInitialViewSet?contentWindow.PDFViewerApplication.page=this.__page??1:this.__processViewerUpdate()}getPageCount(){const contentWindow=this.__elementIFrame[0].contentWindow;return contentWindow?.PDFViewerApplication?.pagesCount?contentWindow.PDFViewerApplication.pagesCount:null}setNamedDestination(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("NamedDestination")),convertedValue!==this.__namedDestination&&(this.__namedDestination=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"NamedDestination"}),this.__processNamedDestination())}getNamedDestination(){return this.__namedDestination}__processNamedDestination(){this.__processViewerUpdate()}setZoom(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Zoom")),convertedValue!==this.__zoom&&(this.__zoom=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Zoom"}),this.__processZoom())}getZoom(){return this.__zoom}__processZoom(){this.__processViewerUpdate()}setPageMode(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("PageMode")),convertedValue!==this.__pageMode&&(this.__pageMode="none"===convertedValue||"thumbs"===convertedValue||"bookmarks"===convertedValue||"attachments"===convertedValue?convertedValue:"none",TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PageMode"}),this.__processZoom())}getPageMode(){return this.__pageMode}__processPageMode(){this.__processViewerUpdate()}setAllowFullscreen(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowFullscreen")),convertedValue!==this.__allowFullscreen&&(this.__allowFullscreen=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowFullscreen"}),this.__processAllowFullscreen())}getAllowFullscreen(){return this.__allowFullscreen}__processAllowFullscreen(){}setDisallowFileOperations(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("DisallowFileOperations")),convertedValue!==this.__disallowFileOperations&&(this.__disallowFileOperations=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"DisallowFileOperations"}),this.__processDisallowFileOperations())}getDisallowFileOperations(){return this.__disallowFileOperations}__processDisallowFileOperations(){const contentWindow=this.__elementIFrame[0].contentWindow;if(!contentWindow)return;const fileOperationButtons=contentWindow.document.querySelectorAll(['[data-l10n-id="pdfjs-print-button"]','[data-l10n-id="pdfjs-open-file-button"]','[data-l10n-id="pdfjs-save-button"]','[data-l10n-id="pdfjs-editor-stamp-add-image-button"]'].join(","));TcHmi.StyleProvider.setSimpleElementStyle(fileOperationButtons,"display",this.__disallowFileOperations?"none":"")}setCursorTool(valueNew){let convertedValue=TcHmi.ValueConverter.toEnum(valueNew,TcHmiPdfViewer.CursorTool)??TcHmi.ValueConverter.toEnum(this.getAttributeDefaultValueInternal("CursorTool"),TcHmiPdfViewer.CursorTool,TcHmiPdfViewer.CursorTool.SELECT);convertedValue!==this.__cursorTool&&(this.__cursorTool=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"CursorTool"}),this.__processCursorTool())}getCursorTool(){return this.__cursorTool}__processCursorTool(){const contentWindow=this.__elementIFrame[0].contentWindow;contentWindow?.PDFViewerApplication?.initialized&&contentWindow.PDFViewerApplication.pdfCursorTools.switchTool(this.__cursorTool??TcHmiPdfViewer.CursorTool.SELECT)}}Beckhoff.TcHmiPdfViewer=TcHmiPdfViewer,function(TcHmiPdfViewer){let CursorTool;!function(CursorTool){CursorTool[CursorTool.SELECT=0]="SELECT",CursorTool[CursorTool.HAND=1]="HAND"}(CursorTool=TcHmiPdfViewer.CursorTool||(TcHmiPdfViewer.CursorTool={}))}(TcHmiPdfViewer=Beckhoff.TcHmiPdfViewer||(Beckhoff.TcHmiPdfViewer={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiPdfViewer","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiPdfViewer);