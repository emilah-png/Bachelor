"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(BaseTemplate){class TcHmiAccordionRegion extends TcHmi.Controls.System.TcHmiControl{static#tchmiFQN="TcHmi.Controls.BaseTemplate."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs)}__elementTemplateRoot;__elementBaseAccordion;__accordionItems;__oldAccordionItems;__newAccordionItemsData=!1;__fileHostAttributesCache=new Map;__autoCollapse;__textHorizontalAlignment;__textVerticalAlignment;__textFontSize;__textFontSizeUnit;__textFontFamily;__textFontStyle;__textFontWeight;__textPadding;__eventDestroyers=[];__previnit(){if(this.__elementTemplateRoot=this.__element[0].getElementsByClassName("TcHmi_Controls_BaseTemplate_TcHmiAccordionRegion-Template")[0],this.__elementBaseAccordion=this.__elementTemplateRoot.querySelector("tchmi-accordion"),!this.__elementTemplateRoot||!this.__elementBaseAccordion)throw new Error("Invalid Template.html");super.__previnit()}__init(){super.__init()}__attach(){super.__attach(),this.__elementBaseAccordion.addItemContentOpenedCallback(this.__onItemOpened),this.__elementBaseAccordion.addItemContentClosedCallback(this.__onItemClosed),this.__eventDestroyers.push(TcHmi.EventProvider.register("onUserDataChanged",this.__onUserDataChanged))}__detach(){super.__detach();for(let e of this.__eventDestroyers)e();this.__eventDestroyers=[]}destroy(){this.__keepAlive||super.destroy()}__removeAccordionItems(accordionItems,destroy=!1){if(accordionItems)for(const accordionItem of accordionItems)accordionItem.fileHost&&destroy&&(accordionItem.fileHost.destroy(),accordionItem.fileHost=void 0),this.__elementBaseAccordion.removeItemByName(accordionItem.name)}__getOpenItems(items){let openItems=[];for(const item of items){const accordionItem=this.__elementBaseAccordion.getItemByName(item.name);accordionItem?.IsOpen()&&openItems.push(item.name)}return openItems}__buildFileHost(accordionItem){if(accordionItem.fileHost&&(accordionItem.fileHost.destroy(),accordionItem.fileHost=void 0),!accordionItem.targetFile)return;let path=accordionItem.targetFile.path,attributes=accordionItem.targetFile.attributes;if(path){if(path.toLowerCase().endsWith(".content")){let attributesExtended={"data-tchmi-target-content":path,"data-tchmi-left":0,"data-tchmi-top":0,"data-tchmi-width":100,"data-tchmi-height":100,"data-tchmi-width-unit":"%","data-tchmi-height-unit":"%","data-tchmi-scrolling":"Auto","data-tchmi-height-mode":"Content"};accordionItem.fileHost=TcHmi.ControlFactory.createEx("TcHmi.Controls.System.TcHmiRegion",this.getId()+".Region_"+accordionItem.name,{...attributesExtended},this)}else if(path?.toLowerCase().endsWith(".usercontrol")){let attributesExtended={"data-tchmi-target-user-control":path,"data-tchmi-left":0,"data-tchmi-top":0,"data-tchmi-width":100,"data-tchmi-height":100,"data-tchmi-width-unit":"%","data-tchmi-height-unit":"%"};accordionItem.fileHost=TcHmi.ControlFactory.createEx("TcHmi.Controls.System.TcHmiUserControlHost",this.getId()+".UserControlHost_"+accordionItem.name,{...attributes,...attributesExtended},this)}this.__setContentElementHeight(accordionItem)}}__attachTargetFileHost(accordionItem){accordionItem.fileHost&&accordionItem.contentElement&&accordionItem.scrollContainer&&(accordionItem.contentElement.textContent="",accordionItem.scrollContainer.textContent="",accordionItem.scrollContainer.append(accordionItem.fileHost.getElement()[0]),accordionItem.contentElement.append(accordionItem.scrollContainer))}__detachTargetFileHost(accordionItem){accordionItem.fileHost?.getElement()[0].remove()}__setContentElementHeight(accordionItem,setMaxHeight=!1){if(accordionItem.fileHost&&accordionItem.contentElement&&accordionItem.scrollContainer)if(accordionItem.fileHost.getIsAttached()){if(accordionItem.fileHost instanceof TcHmi.Controls.System.TcHmiRegion){const contentControl=accordionItem.fileHost?.getCurrentContent();if(!contentControl)return void this.__eventDestroyers.push(TcHmi.EventProvider.register(accordionItem.fileHost.getId()+".onTargetContentReplaced",((e,tco)=>{e.destroy(),this.__setContentElementHeight(accordionItem,setMaxHeight)})));if(!contentControl.getIsAttached())return void this.__eventDestroyers.push(TcHmi.EventProvider.register(contentControl.getId()+".onAttached",((e,tco)=>{e.destroy(),this.__setContentElementHeight(accordionItem,setMaxHeight)})));let contentHeight=accordionItem.fileHost.__getContentHeight()??240;accordionItem.maxContentHeight&&accordionItem.maxContentHeight<contentHeight&&(contentHeight=accordionItem.maxContentHeight),accordionItem.scrollContainer.style.height=contentHeight+"px",accordionItem.contentElement.style.height=contentHeight+"px",setMaxHeight&&(accordionItem.contentElement.style.maxHeight=contentHeight+"px")}else if(accordionItem.fileHost instanceof TcHmi.Controls.System.TcHmiUserControlHost){let contentHeight=accordionItem.fileHost.getCurrentUserControl()?.getElement()[0].getBoundingClientRect().height??240;accordionItem.maxContentHeight&&accordionItem.maxContentHeight<contentHeight?contentHeight=accordionItem.maxContentHeight:contentHeight||(contentHeight=240),accordionItem.scrollContainer.style.height=contentHeight+"px",accordionItem.contentElement.style.height=contentHeight+"px",accordionItem.fileHost.getElement()[0].style.height=contentHeight+"px",setMaxHeight&&(accordionItem.contentElement.style.maxHeight=contentHeight+"px")}}else this.__eventDestroyers.push(TcHmi.EventProvider.register(accordionItem.fileHost.getId()+".onAttached",((e,tco)=>{e.destroy(),this.__setContentElementHeight(accordionItem,setMaxHeight)})))}__buildHeader(accordionItem){accordionItem.headerElement=document.createElement("tchmi-accordion-header"),accordionItem.headerElement.textContent="",accordionItem.iconElement&&accordionItem.headerElement.append(accordionItem.iconElement),accordionItem.headerElement.insertAdjacentHTML("beforeend",accordionItem.text)}__buildIcon(accordionItem){accordionItem.icon?.iconPath?(accordionItem.iconElement=document.createElement("i"),accordionItem.iconElement.style.backgroundImage=`url(${accordionItem.icon.iconPath})`,accordionItem.iconElement.style.backgroundSize=(accordionItem.icon.iconWidth??32)+(accordionItem.icon.iconWidthUnit??"px")+" "+(accordionItem.icon.iconHeight??32)+(accordionItem.icon.iconHeightUnit??"px"),accordionItem.iconElement.style.backgroundRepeat="no-repeat",accordionItem.iconElement.style.height=(accordionItem.icon.iconHeight??32)+(accordionItem.icon.iconHeightUnit??"px"),accordionItem.iconElement.style.width=(accordionItem.icon.iconWidth??32)+(accordionItem.icon.iconWidthUnit??"px"),accordionItem.iconElement.style.minWidth=(accordionItem.icon.iconWidth??32)+(accordionItem.icon.iconWidthUnit??"px")):accordionItem.iconElement=void 0}__onItemOpened=item=>{if(!this.__accordionItems)return;const name=item.getName();if(name)for(let accordionItem of this.__accordionItems)if(accordionItem.name===name)return accordionItem.fileHost||this.__buildFileHost(accordionItem),void(document.body.contains(accordionItem.fileHost?.getElement()[0]??null)||(this.__attachTargetFileHost(accordionItem),this.__setContentElementHeight(accordionItem,!0)))};__onItemClosed=item=>{if(!this.__accordionItems)return;const name=item.getName();if(name)for(let accordionItem of this.__accordionItems)if(accordionItem.name===name)return void(accordionItem.targetFileHostPreload||accordionItem.targetFileHostKeepAlive?accordionItem.targetFileHostPreAttach||this.__detachTargetFileHost(accordionItem):(this.__detachTargetFileHost(accordionItem),accordionItem.fileHost?.destroy(),accordionItem.fileHost=void 0))};__onUserDataChanged=()=>{this.__oldAccordionItems=this.__accordionItems,this.__processAccordionItems()};getAccessConfig(){const currentAccessConfig=super.getAccessConfig();return this.__getSubRights(this.__accordionItems??[],tchmi_clone_object(currentAccessConfig))}__getSubRights(items,accessList){if(!items)return accessList;for(const item of items)if(item.accessRights)for(const itemAccessRight of item.accessRights)if(itemAccessRight){let curAccess={accessright:item.name+":"+itemAccessRight.accessright,group:itemAccessRight.group,permission:itemAccessRight.permission};accessList.push(curAccess)}return accessList}getDescriptionAccessByName(name){return name.includes(":")?{name:name,defaultValueInternal:!0}:null}setAccordionItems(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AccordionItems")),this.__newAccordionItemsData=!0;let resolverInfo=this.__objectResolvers.get("accordionItem");if(resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy()),this.__fileHostAttributesCache=new Map,null!==convertedValue)for(let value of convertedValue)value.targetFile&&value.targetFile.attributes&&(this.__fileHostAttributesCache.set(value.name,value.targetFile.attributes),"string"!=typeof value.targetFile.attributes&&(value.targetFile.attributes=void 0));let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,this);this.__objectResolvers.set("accordionItem",{resolver:resolver,watchCallback:this.__onResolverForAccordionItemsWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForAccordionItemsWatchCallback)})}__onResolverForAccordionItemsWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("AccordionItems"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__accordionItems)||(this.__newAccordionItemsData&&(this.__newAccordionItemsData=!1,this.__removeAccordionItems(this.__accordionItems,!0)),this.__oldAccordionItems=this.__accordionItems,this.__accordionItems=data.value,this.__fileHostAttributesCache.forEach(((fileHostAttributes,name)=>{if(this.__accordionItems)for(let accordionItem of this.__accordionItems)accordionItem.name===name&&"object"==typeof accordionItem.targetFile&&"string"!=typeof fileHostAttributes&&(accordionItem.targetFile.attributes=fileHostAttributes)})),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AccordionItems"}),this.__processAccordionItems()):TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiAccordionRegion.#tchmiFQN!==this.__type?", Origin="+TcHmiAccordionRegion.#tchmiFQN:"")+", Id="+this.getId()+", Attribute=AccordionItems] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))};getAccordionItems(){return this.__accordionItems}__processAccordionItems(){if(!this.__accordionItems)return;let openItems=[];this.__oldAccordionItems&&(openItems=this.__getOpenItems(this.__oldAccordionItems),this.__removeAccordionItems(this.__oldAccordionItems));for(let accordionItem of this.__accordionItems){let observeAccessId=accordionItem.name+":observe",operateAccessId=accordionItem.name+":operate";if(!TcHmi.Access.checkAccess(this,observeAccessId))continue;let oldItem=this.__oldAccordionItems?.find((current=>current.targetFile&&accordionItem.targetFile&&current.targetFile.path===accordionItem.targetFile.path));if(oldItem&&!accordionItem.fileHost){!!tchmi_equal(accordionItem.targetFile.attributes,oldItem.targetFile.attributes)&&accordionItem.targetFileHostPreload?(accordionItem.fileHost=oldItem.fileHost,accordionItem.contentElement=oldItem.contentElement,accordionItem.headerElement=oldItem.headerElement,accordionItem.iconElement=oldItem.iconElement,oldItem.fileHost=void 0):(oldItem.fileHost?.destroy(),oldItem.fileHost=void 0)}if(accordionItem.contentElement||(accordionItem.contentElement=document.createElement("tchmi-accordion-content"),accordionItem.contentElement.style.height=(accordionItem.maxContentHeight??240)+"px"),accordionItem.scrollContainer||(accordionItem.scrollContainer=document.createElement("div"),accordionItem.scrollContainer.classList.add("scroll-container")),!accordionItem.fileHost&&accordionItem.targetFileHostPreload&&this.__buildFileHost(accordionItem),accordionItem.targetFileHostPreload&&accordionItem.targetFileHostPreAttach&&this.__attachTargetFileHost(accordionItem),accordionItem.headerElement&&accordionItem.text===oldItem?.text&&tchmi_equal(accordionItem.icon,oldItem?.icon)||(this.__buildIcon(accordionItem),this.__buildHeader(accordionItem)),accordionItem.contentElement&&accordionItem.headerElement){const addedItem=this.__elementBaseAccordion.addItem(accordionItem.name,accordionItem.headerElement,accordionItem.contentElement);addedItem&&(TcHmi.Access.checkAccess(this,operateAccessId)||addedItem.disable(!0),openItems.includes(accordionItem.name)&&addedItem.open(null))}}if(this.__oldAccordionItems)for(const oldItem of this.__oldAccordionItems)oldItem.fileHost?.destroy(),oldItem.fileHost=void 0;this.__processTextVerticalAlignment(),this.__processTextHorizontalAlignment(),this.__processTextFontSize(),this.__processTextFontFamily(),this.__processTextPadding(),this.__processTextFontWeight(),this.__processTextFontStyle()}setAutoCollapse(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AutoCollapse")),convertedValue!==this.__autoCollapse&&(this.__autoCollapse=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AutoCollapse"}),this.__processAutoCollapse())}getAutoCollapse(){return this.__autoCollapse}__processAutoCollapse(){let accordions=this.__elementTemplateRoot.querySelectorAll("tchmi-accordion");for(let accordion of accordions)accordion.setAutoCollapse(this.__autoCollapse??!0)}setTextHorizontalAlignment(valueNew){let convertedValue=TcHmi.ValueConverter.toHorizontalAlignment(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextHorizontalAlignment")),convertedValue!==this.__textHorizontalAlignment&&(this.__textHorizontalAlignment=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextHorizontalAlignment"}),this.__processTextHorizontalAlignment())}getTextHorizontalAlignment(){return this.__textHorizontalAlignment}__processTextHorizontalAlignment(){for(let item of this.__accordionItems??[])item.headerElement&&TcHmi.StyleProvider.processContentHorizontalAlignment(item.headerElement,this.__textHorizontalAlignment)}setTextVerticalAlignment(valueNew){let convertedValue=TcHmi.ValueConverter.toVerticalAlignment(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextVerticalAlignment")),convertedValue!==this.__textVerticalAlignment&&(this.__textVerticalAlignment=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextVerticalAlignment"}),this.__processTextVerticalAlignment())}getTextVerticalAlignment(){return this.__textVerticalAlignment}__processTextVerticalAlignment(){for(let item of this.__accordionItems??[])item.headerElement&&TcHmi.StyleProvider.processContentVerticalAlignment(item.headerElement,this.__textVerticalAlignment)}setTextFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontSize")),convertedValue!==this.__textFontSize&&(this.__textFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontSize"}),this.__processTextFontSize())}getTextFontSize(){return this.__textFontSize}__processTextFontSize(){for(let item of this.__accordionItems??[])item.headerElement&&(this.__textFontSize?item.headerElement.style.fontSize=this.__textFontSize+(this.__textFontSizeUnit??"px"):item.headerElement.style.fontSize="")}setTextFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontSizeUnit")),convertedValue!==this.__textFontSizeUnit&&(this.__textFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontSizeUnit"}),this.__processTextFontSizeUnit())}getTextFontSizeUnit(){return this.__textFontSizeUnit}__processTextFontSizeUnit(){this.__processTextFontSize()}setTextFontFamily(valueNew){let convertedValue=TcHmi.ValueConverter.toFontFamily(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontFamily")),convertedValue!==this.__textFontFamily&&(this.__textFontFamily=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontFamily"}),this.__processTextFontFamily())}getTextFontFamily(){return this.__textFontFamily}__processTextFontFamily(){for(let item of this.__accordionItems??[])item.headerElement&&(item.headerElement.style.fontFamily=this.__textFontFamily??"")}setTextFontStyle(valueNew){let convertedValue=TcHmi.ValueConverter.toFontStyle(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontStyle")),convertedValue!==this.__textFontStyle&&(this.__textFontStyle=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontStyle"}),this.__processTextFontStyle())}getTextFontStyle(){return this.__textFontStyle}__processTextFontStyle(){for(let item of this.__accordionItems??[])item.headerElement&&TcHmi.StyleProvider.processFontStyle(item.headerElement,this.__textFontStyle)}setTextFontWeight(valueNew){let convertedValue=TcHmi.ValueConverter.toFontWeight(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontWeight")),convertedValue!==this.__textFontWeight&&(this.__textFontWeight=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontWeight"}),this.__processTextFontWeight())}getTextFontWeight(){return this.__textFontWeight}__processTextFontWeight(){for(let item of this.__accordionItems??[])item.headerElement&&TcHmi.StyleProvider.processFontWeight(item.headerElement,this.__textFontWeight)}setTextPadding(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextPadding"));let resolverInfo=this.__objectResolvers.get("textPadding");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,this);this.__objectResolvers.set("textPadding",{resolver:resolver,watchCallback:this.__onResolverForTextPaddingWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForTextPaddingWatchCallback)})}__onResolverForTextPaddingWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("textPadding"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__textPadding)||(this.__textPadding=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextPadding"}),this.__processTextPadding()):TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiAccordionRegion.#tchmiFQN!==this.__type?", Origin="+TcHmiAccordionRegion.#tchmiFQN:"")+", Id="+this.getId()+", Attribute=TextPadding] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))};getTextPadding(){return this.__textPadding}__processTextPadding(){for(let item of this.__accordionItems??[])item.headerElement&&TcHmi.StyleProvider.processContentPadding(item.headerElement,this.__textPadding)}}BaseTemplate.TcHmiAccordionRegion=TcHmiAccordionRegion}(Controls.BaseTemplate||(Controls.BaseTemplate={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiAccordionRegion","TcHmi.Controls.BaseTemplate",TcHmi.Controls.BaseTemplate.TcHmiAccordionRegion);